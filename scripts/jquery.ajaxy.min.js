/*
 GNU Affero General Public License - {@link http://www.gnu.org/licenses/agpl.html}
*/
if(typeof window.console!=="object"||typeof window.console.emulated==="undefined"){if(typeof window.console!=="object"||typeof window.console.log!=="function"){window.console={};window.console.log=window.console.debug=window.console.warn=window.console.trace=function(){};window.console.error=function(){alert("An error has occured. Please use another browser to obtain more detailed information.")}}else{if(typeof window.console.debug==="undefined")window.console.debug=function(){for(var b=["console.debug:"],
a=0;a<arguments.length;a++)b.push(arguments[a]);window.console.log.apply(window.console,b)};if(typeof window.console.warn==="undefined")window.console.warn=function(){for(var b=["console.warn:"],a=0;a<arguments.length;a++)b.push(arguments[a]);window.console.log.apply(window.console,b)};if(typeof window.console.error==="undefined")window.console.error=function(){for(var b=["console.error"],a=0;a<arguments.length;a++)b.push(arguments[a]);window.console.log.apply(window.console,b)};if(typeof window.console.trace===
"undefined")window.console.trace=function(){window.console.error.apply(window.console,["console.trace does not exist"])}}window.console.emulated=true}String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.strip=String.prototype.strip||function(b,a){b=String(b);var c=this;if(b.length){a||0||(b=b.replace(/([\[\]\(\)\^\$\.\?\|\/\\])/g,"\\$1"));c=c.replace(eval("/^"+b+"+|"+b+"+$/g"),"")}return String(c)};
String.prototype.stripLeft=String.prototype.stripLeft||function(b,a){b=String(b);var c=this;if(b.length){a||0||(b=b.replace(/([\[\]\(\)\^\$\.\?\|\/\\])/g,"\\$1"));c=c.replace(eval("/^"+b+"+/g"),"")}return String(c)};String.prototype.stripRight=String.prototype.stripRight||function(b,a){b=String(b);var c=this;if(b.length){a||0||(b=b.replace(/([\[\]\(\)\^\$\.\?\|\/\\])/g,"\\$1"));c=c.replace(eval("/"+b+"+$/g"),"")}return String(c)};
String.prototype.toInt=String.prototype.toInt||function(){return parseInt(this,10)};String.prototype.wrap=String.prototype.wrap||function(b,a){return b+this+a};String.prototype.wrapSelection=String.prototype.wrapSelection||function(b,a,c,e){if(typeof c==="undefined"||c===null)c=this.length;if(typeof e==="undefined"||e===null)e=this.length;return this.substring(0,c)+b+this.substring(c,e)+a+this.substring(e)};
String.prototype.toSlug=String.prototype.toSlug||function(){return this.toLowerCase().replace(/[\s_]/g,"-").replace(/[^-a-z0-9]/g,"").replace(/--+/g,"-").replace(/^-+|-+$/g,"")};
String.prototype.queryStringToJSON=String.prototype.queryStringToJSON||function(){var b=String(this);b=b.substring(b.indexOf("?")+1);b=b.replace(/\+/g,"%20");if(b.substring(0,1)==="{"&&b.substring(b.length-1)==="}")return eval(decodeURIComponent(b));b=b.split(/\&(amp\;)?/);for(var a={},c=0,e=b.length;c<e;++c){var d=b[c]||null;if(d!==null){d=d.split("=");if(d!==null){var f=d[0]||null;if(f!==null)if(typeof d[1]!=="undefined"){d=d[1];f=decodeURIComponent(f);d=decodeURIComponent(d);try{d=eval(d)}catch(g){}var h=
f.split(".");if(h.length===1)a[f]=d;else{var k="",l="";$.each(h,function(n,i){k+='["'+i.replace(/"/g,'\\"')+'"]';jsonCLOSUREGLOBAL=a;l="if ( typeof jsonCLOSUREGLOBAL"+k+' === "undefined" ) jsonCLOSUREGLOBAL'+k+" = {}";eval(l);a=jsonCLOSUREGLOBAL;delete jsonCLOSUREGLOBAL});jsonCLOSUREGLOBAL=a;valueCLOSUREGLOBAL=d;l="jsonCLOSUREGLOBAL"+k+" = valueCLOSUREGLOBAL";eval(l);a=jsonCLOSUREGLOBAL;delete jsonCLOSUREGLOBAL;delete valueCLOSUREGLOBAL}}}}}return a};
(function(b){b.fn.binder=b.fn.binder||function(a,c,e){var d=b(this);if(e)d.bind(a,c,e);else{e=c;d.bind(a,e)}return d};b.fn.once=b.fn.once||function(a,c,e){var d=b(this);if(e){d.unbind(a,e);d.bind(a,c,e)}else{e=c;d.unbind(a,e);d.bind(a,e)}return d};b.fn.enter=b.fn.enter||function(a,c){return b(this).binder("enter",a,c)};b.event.special.enter=b.event.special.cancel||{setup:function(){b(this).bind("keypress",b.event.special.enter.handler)},teardown:function(){b(this).unbind("keypress",b.event.special.enter.handler)},
handler:function(a){b(this);if(a.keyCode===13){a.type="enter";b.event.handle.apply(this,[a]);return true}}};b.fn.cancel=b.fn.cancel||function(a,c){return b(this).binder("cancel",a,c)};b.event.special.cancel=b.event.special.cancel||{setup:function(){b(this).bind("keyup",b.event.special.cancel.handler)},teardown:function(){b(this).unbind("keyup",b.event.special.cancel.handler)},handler:function(a){b(this);var c=a.keyCode===27;if((typeof a.DOM_VK_ESCAPE==="undefined"?false:a.DOM_VK_ESCAPE)||c){a.type=
"cancel";b.event.handle.apply(this,[a]);return true}}};b.fn.lastclick=b.fn.lastclick||function(a,c){return b(this).binder("lastclick",a,c)};b.event.special.lastclick=b.event.special.lastclick||{setup:function(){b(this).bind("click",b.event.special.lastclick.handler)},teardown:function(){b(this).unbind("click",b.event.special.lastclick.handler)},handler:function(a){var c=function(){var e=b(this),d=e.data("lastclick-timeout")||false;d&&clearTimeout(d);d=false;e.data("lastclick-timeout",d)};(function(e){var d=
this;c.call(d);var f=b(d);f.data("lastclick-clicks",(f.data("lastclick-clicks")||0)+1);var g=setTimeout(function(){var h=f.data("lastclick-clicks");c.apply(d,[e]);f.data("lastclick-clicks",0);e.type="lastclick";b.event.handle.apply(d,[e,h])},500);f.data("lastclick-timeout",g)}).apply(this,[a])}};b.fn.firstclick=b.fn.firstclick||function(a,c){return b(this).binder("firstclick",a,c)};b.event.special.firstclick=b.event.special.firstclick||{setup:function(){b(this).bind("click",b.event.special.firstclick.handler)},
teardown:function(){b(this).unbind("click",b.event.special.firstclick.handler)},handler:function(a){var c=function(){var e=b(this),d=e.data("firstclick-timeout")||false;d&&clearTimeout(d);d=false;e.data("firstclick-timeout",d)};(function(e){var d=this;c.call(d);var f=b(d);f.data("firstclick-clicks",(f.data("firstclick-clicks")||0)+1);if(f.data("firstclick-clicks")===1){e.type="firstclick";b.event.handle.apply(d,[e])}var g=setTimeout(function(){c.apply(d,[e]);f.data("firstclick-clicks",0)},500);f.data("firstclick-timeout",
g)}).apply(this,[a])}};b.fn.singleclick=b.fn.singleclick||function(a,c){return b(this).binder("singleclick",a,c)};b.event.special.singleclick=b.event.special.singleclick||{setup:function(){b(this).bind("click",b.event.special.singleclick.handler)},teardown:function(){b(this).unbind("click",b.event.special.singleclick.handler)},handler:function(a){var c=function(){var e=b(this),d=e.data("singleclick-timeout")||false;d&&clearTimeout(d);d=false;e.data("singleclick-timeout",d)};(function(e){var d=this;
c.call(d);var f=b(d);f.data("singleclick-clicks",(f.data("singleclick-clicks")||0)+1);var g=setTimeout(function(){var h=f.data("singleclick-clicks");c.apply(d,[e]);f.data("singleclick-clicks",0);if(h===1){e.type="singleclick";b.event.handle.apply(d,[e])}},500);f.data("singleclick-timeout",g)}).apply(this,[a])}}})(jQuery);
(function(b){b.fn.opacityFix=b.fn.opacityFix||function(){var a=b(this),c=a.css("background-color");if(c&&c!=="rgba(0, 0, 0, 0)")return this;for(var e=a;e.inDOM();){e=e.parent();if((c=e.css("background-color"))&&c!=="rgba(0, 0, 0, 0)"){a.css("background-color",c);break}}return this};b.fn.parentsAndSelf=b.fn.parentsAndSelf||function(a){return b(this).parents(a).andSelf().filter(a)};b.fn.findAndSelf=b.fn.findAndSelf||function(a){return b(this).find(a).andSelf().filter(a)};b.fn.firstInput=b.fn.firstInput||
function(){return b(this).findAndSelf(":input").filter(":first")};b.fn.choose=b.fn.choose||function(a){var c=b(this);if(typeof a==="undefined")a=c.val();else if(c.val()!==a)return this;switch(true){case this.is("option"):c.parents("select:first").choose(a);break;case c.is(":checkbox"):c.attr("checked",true);break;case c.is(":radio"):c.attr("checked",true);break;case c.is("select"):c.val(a);break;default:break}return this};b.fn.unchoose=b.fn.unchoose||function(){var a=b(this);switch(true){case a.is("option"):a.parents(":select:first").unchoose();
break;case a.is(":checkbox"):a.attr("checked",false);break;case a.is(":radio"):a.attr("checked",false);break;case a.is("select"):a.val(a.find("option:first").val());break;default:break}return this};b.fn.wouldSubmit=b.fn.wouldSubmit||function(){var a=b(this).findAndSelf(":input"),c=true;if(!a.length||!(a.attr("name")||0)||a.is(":radio,:checkbox")&&!a.is(":selected,:checked"))c=false;return c};b.fn.values=b.fn.values||function(){var a={};b(this).findAndSelf(":input").each(function(){var c=b(this),e=
c.attr("name")||null,d=c.val();if(!c.wouldSubmit())return true;if(e.indexOf("[]")!==-1){if(typeof a[e]==="undefined")a[e]=[];a[e].push(d)}else a[e]=d});return a};b.fn.submitForm=b.fn.submitForm||function(){var a=b(this);a.parentsAndSelf("form:first").trigger("submit");return a};b.fn.inDOM=function(){var a=b(this).parent().parent();return a.size()&&(a.height()||a.width())};b.fn.valWrap=function(a,c){var e=b(this);return e.val(e.val().wrap(a,c))};b.fn.valWrapSelection=function(a,c,e,d){var f=b(this),
g=f.get(0);a=a||"";c=c||"";if(e||d)f.val(f.val().wrapSelection(a,c,e,d));else{e=g.selectionStart;d=g.selectionEnd;if(document.selection){g.focus();e=document.selection.createRange();e.text=a+e.text+c}else{var h=g.scrollTop;f.val(f.val().wrapSelection(a,c,e,d));g.focus();g.selectionStart=e+a.length;g.selectionEnd=d+a.length;g.scrollTop=h}}return f};b.fn.giveFocus=function(){b(this).findAndSelf(":input:visible:first").focus();return this};b.fn.highlight=function(a){return b(this).effect("highlight",
{},a||3E3)}})(jQuery);
(function(b){b(document.body).addClass("js");if(b.Ajaxy)window.console.warn("$.Ajaxy has already been defined...");else{b.Ajaxy={options:{root_url:"",base_url:"",relative_url:"",no_history_class:"ajaxy-no_history,ajaxy__no_history",use_request_controller_as_default:true,redirect:false,relative_as_base:true,support_text:true,analytics:true,auto_ajaxify:true,debug:true},constructed:false,controllers:{},hashes:{},ajaxqueue:[],data:{},redirected:false,format:function(a){var c=b.Ajaxy,e=b.History;a=a.replace(/^\//,
"").strip(c.options.root_url).strip(c.options.base_url);if(a=e.format(a))a="/"+a;return a},bind:function(a,c){var e=b.Ajaxy;if(typeof c==="undefined"&&typeof a==="object"){for(index in a)e.bind(index,a[index]);return true}else if(typeof c==="function")c={response:c};else if(typeof c!=="object"){window.console.error("AJAXY: Bind: Unknown option type",a,c);return false}if(typeof e.controllers[a]==="undefined")e.controllers[a]={trigger:function(d){return e.trigger(a,d)},ajaxy_data:{},response_data:{},
request_data:{},error_data:{}};for(option in c)e.controllers[a][option]=c[option];e.ajaxifyController(a);return true},trigger:function(a,c,e,d){var f=b.Ajaxy;f.options.debug&&window.console.debug("Ajaxy.trigger: ",[this,arguments,d]);d=d||{};e=e||[];var g;g=true;if(typeof a==="undefined"||a===null){window.console.info("Ajaxy.trigger: Controller Reset",[a,c],[this,arguments]);a="_generic"}if(typeof f.controllers[a]==="undefined"){window.console.error("Ajaxy.trigger: No Controller",[a,c],[this,arguments]);
window.console.trace();a!=="_generic"&&f.trigger("_generic","error",e,d);return false}if(typeof f.controllers[a][c]==="undefined"){window.console.error("Ajaxy.trigger: No Controller Action",[a,c],[this,arguments]);window.console.trace();a!=="_generic"&&f.trigger("_generic","error",e,d);return false}d.propagate=typeof d.propagate==="undefined"||d.propagate?true:false;d.state=d.hash=d.hash||null;d.controller=d.controller||null;d.form=d.form||null;d.request_data=d.request_data||{};d.request_data=d.request_data||
{};d.response_data=d.response_data||{};d.error_data=d.error_data||{};d.user_data=d.user_data||{};d.ajaxy_data=b.extend({},{controller:a,action:c},d.ajaxy_data||{});f.controllers[a].state=d.hash;f.controllers[a].hash=d.hash;f.controllers[a].controller=d.controller;f.controllers[a].form=d.form;f.controllers[a].propagate=d.propagate;f.controllers[a].request_data=d.request_data;f.controllers[a].response_data=d.response_data;f.controllers[a].error_data=d.error_data;f.controllers[a].user_data=d.user_data;
f.controllers[a].ajaxy_data=d.ajaxy_data;f.controllers[a].forward=function(h,k,l,n){f.options.debug&&window.console.debug("Ajaxy.triger.forward:",[a,c,e,d],[this,arguments]);k=k||c;l=l||e;n=n||this;f.trigger(h,k,l,n);return true};f.controllers[a][c].apply(f.controllers[a],e);if(f.controllers[a].propagate===false)g=false;g&&a!=="_generic"&&f.controllers[a].forward("_generic");return true},get:function(a){var c=b.Ajaxy;if(typeof c.data[a]!=="undefined")return c.data[a]},set:function(a,c){var e=b.Ajaxy;
if(typeof c==="undefined")typeof a==="object"&&e.data.extend(true,a);else e.data[a]=c},refresh:function(){return b.Ajaxy.go(b.History.getHash())},go:function(a){var c=b.Ajaxy,e=b.History;c.options.debug&&window.console.debug("Ajaxy.go:",[this,arguments]);if(typeof a==="string")a={hash:a};var d={url:a.url||null,hash:a.hash||null,controller:a.controller||null,form:a.form||null,data:a.data||{},history:typeof a.history==="undefined"?null:a.history,response:a.response||a.success||null,request:a.request||
null,error:a.error||null};if(!d.hash&&d.url){d.hash=c.format(d.url);if(d.history===null)d.history=false}else if(d.form){if(d.history===null)d.history=false}else if(d.history===null)d.history=true;d.history=d.history?true:false;if(d.hash)d.hash=c.format(d.hash);else{window.console.error("Ajaxy.request: No hash");return false}d.hash!==e.getHash()&&c.options.debug&&c.options.debug&&window.console.debug("Ajaxy.request: Trigger but no change.",d.hash);c.hashes[d.hash]=d;d.history?e.go(d.hash):c.hashchange(d.hash);
return true},track:function(a){typeof pageTracker!=="undefined"&&pageTracker._trackPageview("/"+a)},request:function(a){var c=b.Ajaxy,e=b.History;a=c.format(a);if(c.redirected!==false)c.redirected=false;else{c.ajaxqueue.push(a);if(c.ajaxqueue.length!==1)return false;this.options.analytics&&c.track(a);var d;d=c.hashes[a]=c.hashes[a]||{};d.url=d.url||c.options.root_url+c.options.base_url+(a.replace(/^\//,"")||"?");d.hash=a;d.controller=d.controller||null;d.form=d.form||null;d.data=d.data||{};d.data.Ajaxy=
true;d.response=d.response||null;d.request=d.request||null;d.error=d.error||null;d.request_data=d.request_data||{};d.response_data=d.response_data||{};d.error_data=d.error_data||{};c.trigger("_generic","request");var f;f={data:d.data,url:d.url,type:"post",success:function(i){c.options.debug&&window.console.debug("Ajaxy.request.success:",[this,arguments]);i=i||{};i.Ajaxy=i.Ajaxy||{};if(i.Ajaxy.redirected){var j=c.format(i.Ajaxy.redirected.to);c.redirected={status:true,from:a,to:j};e.go(j)}c.ajaxqueue.shift();
if((j=c.ajaxqueue.pop())&&j!==a){c.ajaxqueue=[];c.hashchange(j);return false}d.response_data=i;d.error_data={};j=i.controller||null;if(!j&&c.options.use_request_controller_as_default)j=d.controller;if(d.response){if(d.response.apply(d,arguments)||j==="callback")return true;j||(j="_generic")}return c.trigger(j,"response",[],d)},error:function(i,j,p,o){c.options.debug&&window.console.debug("Ajaxy.request.error:",[this,arguments]);o||(o={responseText:i.responseText.trim()||false});c.ajaxqueue.shift();
var m=c.ajaxqueue.pop();if(m&&m!==a){c.ajaxqueue=[];c.hashchange(m);return false}d.request_data.XMLHttpRequest=i;d.response_data=o;d.error_data={};m=o.controller||null;if(d.response){if(d.response.apply(d,arguments)||m==="callback")return true;m||(m="_generic")}return c.trigger(m,"error",[],d)},complete:function(i){c.options.debug&&window.console.debug("Ajaxy.request.complete:",[this,arguments]);d.request_data.XMLHttpRequest=i}};if(d.form){var g=b(d.form);if(g.attr("enctype")==="multipart/form-data"){var h=
"ajaxy_form_iframe_"+Math.floor(Math.random()*99999),k=b('<iframe style="display:none" src="about:blank" id="'+h+'" name="'+h+'" >').appendTo("body").hide(),l=b('<input type="hidden" name="ajax" value="true"/>').appendTo(g),n=b('<input type="hidden" name="Ajaxy[form]" value="true"/>').appendTo(g);k.bind("load",function(){if((this.document||this.currentDocument||this.contentWindow.document).location.href==="about:blank")return true;var i=k.contents().find(".response").val(),j=false;try{j=JSON.parse(i)}catch(p){window.console.error("Invalid response: ",
i,[this,arguments])}j?f.success(j):f.error(j);g.removeAttr("target");k.remove();l.remove();n.remove()});g.attr("target",h);g.submit();h=g.values();f.data=d.data=b.extend(f.data,h);d.request_data=f;return true}else{h=g.values();f.data=d.data=b.extend(f.data,h)}}d.request_data=f;return c.ajax(f)}},ajax:function(a){var c=b.Ajaxy,e={};e.success=a.success||function(){c.options.debug&&window.console.debug("Ajaxy.ajax.callbacks.success:",[this,arguments]);b(".error").empty()};e.error=a.error||function(d,
f,g){c.options.debug&&window.console.debug("Ajaxy.ajax.callbacks.error:",[this,arguments]);b(".error").html(g)};e.complete=a.complete||function(){c.options.debug&&window.console.debug("Ajaxy.ajax.callbacks.complete:",[this,arguments])};delete a.success;delete a.error;delete a.complete;a=b.extend({type:"post",dataType:c.options.support_text?"text":"json"},a||{});a.success=function(d,f){var g={};if(c.options.support_text){if(d)try{g=JSON.parse(d)}catch(h){g={content:d}}finally{}}else g=d;c.options.debug&&
window.console.debug("Ajaxy.ajax.success:",[this,arguments],[c,g,d]);if(typeof g.controller==="undefined"&&(typeof g.success!=="undefined"&&!g.success||typeof g.error!=="undefined"&&g.error))return e.error.apply(this,[null,f,g.error||true,g]);return e.success.apply(this,[g,f])};a.error=function(d,f,g){c.options.debug&&window.console.debug("Ajaxy.ajax.error:",[this,arguments]);var h=d.responseText||false;if(h)h=h.trim();h||(h=false);var k={error:g||true,responseText:h};if(h)try{k=JSON.parse(h)}catch(l){}finally{return this.success.apply(this,
[k,f])}return e.error.apply(this,[d,f,g,k])};return b.ajax(a)},hashchange:function(a){b.Ajaxy.request(a)},configure:function(a){var c=b.Ajaxy,e;if(typeof a.controllers!=="undefined"){e=a.controllers;delete a.controllers}typeof a.routes!=="undefined"&&delete a.routes;c.options=b.extend(c.options,a);c.bind(e);c.options.root_url=(c.options.root_url||document.location.protocol.toString()+"//"+document.location.hostname.toString()).replace(/\/$/,"")+"/";c.options.base_url=(c.options.base_url||"").replace(/^\/|\/$/g,
"");if(c.options.base_url)c.options.base_url+="/";c.options.relative_url=c.format(c.options.relative_url||document.location.pathname.toString().replace(/^\//,""));if(c.options.relative_as_base)if(c.options.base_url.length===0){c.options.base_url=c.options.relative_url;c.options.relative_url=""}c.options.debug&&window.console.debug("Ajaxy.configure:",[this,arguments]);if(c.options.redirect&&c.options.relative_url&&c.options.relative_url!==null)document.location=c.options.root_url+c.options.base_url+
"#"+c.options.relative_url;return true},construct:function(){var a=b.Ajaxy,c=b.History;if(!a.constructed){a.constructed=true;c.bind(function(e){return a.hashchange(e)});b.fn.ajaxify=a.ajaxify;b.fn.ajaxy=a.ajaxify;b(function(){a.domReady();c.domReady()});return true}},domReady:function(){b.Ajaxy.options.auto_ajaxify&&b("body").ajaxify();return true},ajaxify:function(){var a=b.Ajaxy,c=b(this);for(var e in b.Ajaxy.controllers)b.Ajaxy.ajaxifyController(e);c.findAndSelf("a.ajaxy").once("click",a.ajaxify_helpers.a);
c.findAndSelf("form.ajaxy").once("submit",a.ajaxify_helpers.form);return this},ajaxifyController:function(a){var c=b.Ajaxy;typeof this.controllers[a].selector!=="undefined"&&b(function(){b(c.controllers[a].selector).data("ajaxy-controller",a).once("click",c.ajaxify_helpers.a)})},ajaxify_helpers:{a:function(a){var c=b.Ajaxy,e=b(this),d=c.format(e.attr("href")),f=!e.hasClass(c.options.no_history_class);e=e.data("ajaxy-controller")||null;c.go({hash:d,controller:e,history:f});a.stopPropagation();a.preventDefault();
return false},form:function(a){var c=b.Ajaxy,e=b(this),d=e.attr("disabled");if(d=d||d==="false")return false;if(e.attr("target"))return true;e=b.Ajaxy.format(e.attr("action"));c.go({hash:e,form:this});a.stopPropagation();a.preventDefault();return false}}};b.Ajaxy.construct()}})(jQuery);
